<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原子結構互動模擬器</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            touch-action: manipulation; /* Prevent double-tap zoom */
        }
        .canvas-container {
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .control-btn {
            transition: all 0.1s;
        }
        .control-btn:active {
            transform: scale(0.95);
        }
        .stat-box {
            transition: background-color 0.3s;
        }
        /* Custom scrollbar for data panel */
        .data-panel::-webkit-scrollbar {
            width: 6px;
        }
        .data-panel::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Left Side: Visualization -->
    <div class="relative w-full md:w-3/5 h-1/2 md:h-full canvas-container flex items-center justify-center overflow-hidden">
        <canvas id="atomCanvas"></canvas>
        
        <!-- Legend -->
        <div class="absolute bottom-4 left-4 bg-black/60 backdrop-blur-sm text-white p-3 rounded-lg text-xs md:text-sm select-none pointer-events-none">
            <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-red-500 block"></span> 質子 (Protons)</div>
            <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-gray-400 block"></span> 中子 (Neutrons)</div>
            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-yellow-400 block shadow-[0_0_5px_yellow]"></span> 電子 (Electrons)</div>
        </div>

        <!-- Big Symbol Overlay -->
        <div class="absolute top-4 right-4 bg-white/90 backdrop-blur text-slate-800 p-4 rounded-xl shadow-lg border-2 border-slate-200">
            <div id="displaySymbol" class="text-5xl font-serif font-bold text-center leading-none relative">
                H
                <span id="displayCharge" class="absolute -top-1 -right-4 text-2xl font-sans text-blue-600"></span>
            </div>
            <div id="displayName" class="text-center text-sm font-bold mt-1 text-slate-500">Hydrogen</div>
        </div>
    </div>

    <!-- Right Side: Controls & Data -->
    <div class="w-full md:w-2/5 h-1/2 md:h-full bg-white flex flex-col border-l border-gray-200">
        
        <!-- Header -->
        <div class="p-4 bg-slate-50 border-b border-gray-200">
            <h1 class="text-xl font-bold text-slate-800">原子結構模擬器</h1>
            <p class="text-xs text-slate-500">中三級化學 (S3 Chemistry)</p>
        </div>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-4 space-y-6 data-panel">
            
            <!-- Controls Section -->
            <div class="space-y-4">
                
                <!-- Protons Control -->
                <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                    <div class="flex justify-between items-center mb-2">
                        <label class="font-bold text-red-800 flex items-center gap-2">
                            <span class="bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">p</span>
                            質子數量 (Protons)
                        </label>
                        <span class="text-xs text-red-600 font-semibold">決定元素種類</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="changeProtons(-1)" class="control-btn w-12 h-12 rounded-lg bg-white border-2 border-red-200 text-red-600 text-2xl font-bold shadow-sm hover:bg-red-50 hover:border-red-300">-</button>
                        <div id="valProtons" class="flex-1 text-center text-3xl font-mono font-bold text-red-700 bg-white py-2 rounded-lg border border-red-100">1</div>
                        <button onclick="changeProtons(1)" class="control-btn w-12 h-12 rounded-lg bg-red-500 border-2 border-red-600 text-white text-2xl font-bold shadow-sm hover:bg-red-600 hover:border-red-700">+</button>
                    </div>
                </div>

                <!-- Electrons Control -->
                <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                    <div class="flex justify-between items-center mb-2">
                        <label class="font-bold text-yellow-800 flex items-center gap-2">
                            <span class="bg-yellow-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">e</span>
                            電子數量 (Electrons)
                        </label>
                        <span class="text-xs text-yellow-600 font-semibold">決定電荷</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="changeElectrons(-1)" class="control-btn w-12 h-12 rounded-lg bg-white border-2 border-yellow-200 text-yellow-600 text-2xl font-bold shadow-sm hover:bg-yellow-50 hover:border-yellow-300">-</button>
                        <div id="valElectrons" class="flex-1 text-center text-3xl font-mono font-bold text-yellow-700 bg-white py-2 rounded-lg border border-yellow-100">1</div>
                        <button onclick="changeElectrons(1)" class="control-btn w-12 h-12 rounded-lg bg-yellow-400 border-2 border-yellow-500 text-white text-2xl font-bold shadow-sm hover:bg-yellow-500 hover:border-yellow-600">+</button>
                    </div>
                    <button onclick="resetNeutral()" class="w-full mt-3 py-1.5 text-sm font-semibold text-yellow-700 bg-white border border-yellow-200 rounded hover:bg-yellow-50 transition-colors">
                        重置為中性原子 (Make Neutral)
                    </button>
                </div>

            </div>

            <!-- Data Display Section -->
            <div class="grid grid-cols-2 gap-3">
                
                <div class="stat-box bg-slate-50 p-3 rounded-lg border border-slate-200">
                    <div class="text-xs text-slate-500 mb-1">中子 (Neutrons)</div>
                    <div id="valNeutrons" class="text-xl font-mono font-bold text-slate-700">0</div>
                </div>

                <div class="stat-box bg-slate-50 p-3 rounded-lg border border-slate-200">
                    <div class="text-xs text-slate-500 mb-1">質量數 (Mass No.)</div>
                    <div id="valMass" class="text-xl font-mono font-bold text-slate-700">1</div>
                </div>

                <div class="stat-box bg-blue-50 p-3 rounded-lg border border-blue-200 col-span-2">
                    <div class="text-xs text-blue-500 mb-1 font-bold">電子排布 (Electronic Arrangement)</div>
                    <div id="valConfig" class="text-2xl font-mono font-bold text-blue-700 tracking-wider">1</div>
                </div>

                <div class="stat-box bg-slate-50 p-3 rounded-lg border border-slate-200 col-span-2">
                    <div class="flex justify-between items-end">
                        <div>
                            <div class="text-xs text-slate-500 mb-1">淨電荷 (Net Charge)</div>
                            <div id="valNetCharge" class="text-xl font-mono font-bold text-slate-700">0</div>
                        </div>
                        <div id="particleType" class="text-xs font-bold px-2 py-1 rounded bg-slate-200 text-slate-600">
                            中性原子
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- Chemistry Data (Elements 1-20) ---
        // n represents neutrons of the most abundant isotope
        const elementsDB = [
            null, // 0 index place holder
            { symbol: "H", name: "氫 (Hydrogen)", n: 0 },
            { symbol: "He", name: "氦 (Helium)", n: 2 },
            { symbol: "Li", name: "鋰 (Lithium)", n: 4 },
            { symbol: "Be", name: "鈹 (Beryllium)", n: 5 },
            { symbol: "B", name: "硼 (Boron)", n: 6 },
            { symbol: "C", name: "碳 (Carbon)", n: 6 },
            { symbol: "N", name: "氮 (Nitrogen)", n: 7 },
            { symbol: "O", name: "氧 (Oxygen)", n: 8 },
            { symbol: "F", name: "氟 (Fluorine)", n: 10 },
            { symbol: "Ne", name: "氖 (Neon)", n: 10 },
            { symbol: "Na", name: "鈉 (Sodium)", n: 12 },
            { symbol: "Mg", name: "鎂 (Magnesium)", n: 12 },
            { symbol: "Al", name: "鋁 (Aluminium)", n: 14 },
            { symbol: "Si", name: "硅 (Silicon)", n: 14 },
            { symbol: "P", name: "磷 (Phosphorus)", n: 16 },
            { symbol: "S", name: "硫 (Sulphur)", n: 16 },
            { symbol: "Cl", name: "氯 (Chlorine)", n: 18 }, // Cl-35 (75%)
            { symbol: "Ar", name: "氬 (Argon)", n: 22 },    // Ar-40 (99.6%) - Anomaly!
            { symbol: "K", name: "鉀 (Potassium)", n: 20 },
            { symbol: "Ca", name: "鈣 (Calcium)", n: 20 }
        ];

        // --- App State ---
        let protons = 1;
        let electrons = 1;

        // --- Canvas Setup ---
        const canvas = document.getElementById('atomCanvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            drawAtom();
        }
        window.addEventListener('resize', resizeCanvas);

        // --- Core Logic ---

        function changeProtons(delta) {
            let newVal = protons + delta;
            if (newVal < 1) newVal = 1;
            if (newVal > 20) newVal = 20; // Limit to Ca for S3 level
            protons = newVal;
            
            // Interaction Rule: When changing element, suggest neutral state? 
            // Or keep electron count? Let's keep electron count unless it becomes physically impossible (0)
            // But usually, changing protons keeps electrons for UX, unless explicitly resetting.
            
            updateModel();
        }

        function changeElectrons(delta) {
            let newVal = electrons + delta;
            if (newVal < 0) newVal = 0;
            if (newVal > 20) newVal = 20; // Limit max electrons for visual clarity
            electrons = newVal;
            updateModel();
        }

        function resetNeutral() {
            electrons = protons;
            updateModel();
        }

        function getElectronConfig(e) {
            // S3 Rule: 2, 8, 8, 2
            let config = [];
            let remaining = e;

            // Shell 1: Max 2
            if (remaining > 0) {
                let fill = Math.min(remaining, 2);
                config.push(fill);
                remaining -= fill;
            } else { return [0]; }

            // Shell 2: Max 8
            if (remaining > 0) {
                let fill = Math.min(remaining, 8);
                config.push(fill);
                remaining -= fill;
            }

            // Shell 3: Max 8 (Simplified for S3)
            if (remaining > 0) {
                let fill = Math.min(remaining, 8);
                config.push(fill);
                remaining -= fill;
            }
            
            // Shell 4: Max 2 (For K, Ca)
            if (remaining > 0) {
                let fill = Math.min(remaining, 2); // Actually can hold more later, but S3 stops at Ca
                config.push(fill);
                remaining -= fill;
            }

            return config;
        }

        function updateModel() {
            // 1. Get Derived Data
            const element = elementsDB[protons];
            const neutrons = element.n;
            const mass = protons + neutrons;
            const netCharge = protons - electrons;
            const config = getElectronConfig(electrons);

            // 2. Update DOM
            document.getElementById('valProtons').innerText = protons;
            document.getElementById('valElectrons').innerText = electrons;
            document.getElementById('valNeutrons').innerText = neutrons;
            document.getElementById('valMass').innerText = mass;
            document.getElementById('valConfig').innerText = config.join(', ');
            
            document.getElementById('displaySymbol').childNodes[0].nodeValue = element.symbol;
            document.getElementById('displayName').innerText = element.name;

            // Charge Display Logic
            let chargeText = "";
            let chargeClass = "text-slate-700";
            let typeText = "中性原子 (Neutral Atom)";
            let typeClass = "bg-slate-200 text-slate-600";

            if (netCharge > 0) {
                chargeText = "+" + netCharge;
                chargeClass = "text-red-600";
                typeText = "陽離子 (Cation)";
                typeClass = "bg-red-100 text-red-700";
            } else if (netCharge < 0) {
                chargeText = netCharge;
                chargeClass = "text-blue-600";
                typeText = "陰離子 (Anion)";
                typeClass = "bg-blue-100 text-blue-700";
            }
            document.getElementById('valNetCharge').innerText = netCharge === 0 ? "0" : chargeText;
            document.getElementById('valNetCharge').className = `text-xl font-mono font-bold ${chargeClass}`;
            
            const typeEl = document.getElementById('particleType');
            typeEl.innerText = typeText;
            typeEl.className = `text-xs font-bold px-2 py-1 rounded ${typeClass}`;

            // Symbol Superscript logic
            let supText = "";
            if (netCharge !== 0) {
                let absCharge = Math.abs(netCharge);
                let sign = netCharge > 0 ? "+" : "-";
                supText = (absCharge === 1 ? "" : absCharge) + sign;
            }
            document.getElementById('displayCharge').innerText = supText;
            document.getElementById('displayCharge').className = netCharge > 0 ? "absolute -top-1 -right-6 text-2xl font-sans text-red-600" : "absolute -top-1 -right-6 text-2xl font-sans text-blue-600";


            // 3. Redraw Canvas
            drawAtom(protons, neutrons, config);
        }

        function drawAtom(p, n, config) {
            // Clear
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            
            // Dynamic scaling based on shell count to keep it fitted
            const maxRadius = Math.min(cx, cy) - 20;
            const shellCount = Math.max(config.length, 1);
            const baseRadius = 30; // Nucleus area
            const step = (maxRadius - baseRadius) / 4; // Max 4 shells typically

            // Draw Nucleus
            ctx.beginPath();
            ctx.arc(cx, cy, 25, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Nucleus Text
            ctx.fillStyle = '#0f172a';
            ctx.font = 'bold 12px monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(`${p}p`, cx, cy - 7);
            ctx.fillText(`${n}n`, cx, cy + 7);

            // Draw Shells and Electrons
            config.forEach((count, index) => {
                const radius = baseRadius + (index + 1) * step;

                // Shell line
                ctx.beginPath();
                ctx.arc(cx, cy, radius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Electrons
                if (count > 0) {
                    const angleStep = (Math.PI * 2) / count;
                    // Offset angle slightly so they don't all align at 3 o'clock
                    const offset = -Math.PI / 2; 

                    for (let i = 0; i < count; i++) {
                        const angle = i * angleStep + offset;
                        const ex = cx + Math.cos(angle) * radius;
                        const ey = cy + Math.sin(angle) * radius;

                        // Electron Glow
                        const gradient = ctx.createRadialGradient(ex, ey, 0, ex, ey, 8);
                        gradient.addColorStop(0, 'rgba(250, 204, 21, 1)');
                        gradient.addColorStop(0.4, 'rgba(250, 204, 21, 0.5)');
                        gradient.addColorStop(1, 'rgba(250, 204, 21, 0)');

                        ctx.beginPath();
                        ctx.arc(ex, ey, 8, 0, Math.PI * 2);
                        ctx.fillStyle = gradient;
                        ctx.fill();
                        
                        // Electron Core
                        ctx.beginPath();
                        ctx.arc(ex, ey, 3, 0, Math.PI * 2);
                        ctx.fillStyle = '#fef08a';
                        ctx.fill();
                    }
                }
            });
        }

        // Init
        resizeCanvas();
        updateModel();

    </script>
</body>
</html>
```
```
